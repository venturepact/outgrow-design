var footer = '<div class="container">'+
	'<div class="col-xs-12 col-sm-12 np">'+
		'<div class="col-xs-12 col-sm-2 footer-link mk-animate-element fade-in">'+
			'<h4>Overview</h4>'+
			'<ul>'+
				'<li><a href="why_calculators.html" onclick="callGA(\'WHYF\')" class="params">Why Interactive Content</a></li>'+
				'<li><a href="features.html" onclick="callGA(\'FEATURESF\')" class="params">Features </a></li>'+
				'<li><a href="examples.html" onclick="callGA(\'USECASEF\')" class="params">Examples</a></li>'+
				'<li><a href="pricing.html" onclick="callGA(\'PRICINGF\')" class="params">Pricing</a></li>'+
				'<li><a href="http://resources.outgrow.co/" onclick="callGA(\'RESOURCEF\')" class="params">Resources</a></li>'+
				'<li><a href="http://resources.outgrow.co/about" onclick="callGA(\'ABOUTF\')" class="params">About</a></li>'+
				'<li><a href="privacy_policy.html" onclick="callGA(\'PRIVACYF\')" class="params">Privacy Policy</a></li>'+
				'<li><a href="tos.html" onclick="callGA(\'TERMSF\')" class="params">Terms of Services</a></li>'+
			'</ul>'+
		'</div>'+
		'<div class="col-xs-12 col-sm-5 footer-link mk-animate-element fade-in hide">'+
			'<h4>Our Live Calculators</h4>'+
			'<div class="footer-img col-xs-6 col-sm-6"><img src="images/footer1.jpg" /></div>'+
			'<div class="footer-img col-xs-6 col-sm-6"><img src="images/footer2.jpg" /></div>'+
			'<div class="footer-img col-xs-6 col-sm-6"><img src="images/footer4.jpg" /></div>'+
			'<div class="footer-img col-xs-6 col-sm-6"><img src="images/footer3.jpg" /></div>'+
		'</div>'+
		'<div class="col-xs-12 col-sm-10 footer-link mk-animate-element fade-in">'+
			'<h4 class="footer-img2text col-xs-12">Resources</h4>'+
			'<div class="footer-img2 col-xs-6 col-sm-3">'+
				'<div class="col-xs-12 np"><img src="images/res1.jpg" /></div>'+
				'<div class="col-xs-12 np footer-img-text">'+
					'<a href="http://resources.outgrow.co/content-marketing-strategy-checklist">Is Your Content Marketing Worth All The Effort? Consult Our 10 Point Checklist.</a>'+
				'</div>'+
			'</div>'+
			'<div class="footer-img2 col-xs-6 col-sm-3">'+
				'<div class="col-xs-12 np"><img src="images/footer5.jpg" /></div>'+
				'<div class="col-xs-12 np footer-img-text">'+
					'<a href="http://resources.outgrow.co/interactive-calculators-content-make-digital-marketing-agency-stand-out/">Make Your Digital Marketing Agency Stand Out</a>'+
				'</div>'+
			'</div>'+
			'<div class="footer-img2 col-xs-6 col-sm-3">'+
				'<div class="col-xs-12 np"><img src="images/res3.jpg" /></div>'+
				'<div class="col-xs-12 np footer-img-text">'+
					'<a href="http://resources.outgrow.co/university-college-calculators/">7 Interactive Calculators Every University Needs on Its Website</a>'+
				'</div>'+
			'</div>'+
			'<div class="footer-img2 col-xs-6 col-sm-3">'+
				'<div class="col-xs-12 np"><img src="images/res4.jpg" /></div>'+
				'<div class="col-xs-12 np footer-img-text">'+
					'<a href="http://resources.outgrow.co/lead-retention-activate-cold-leads">Lead Retention Made Easy! Activate Cold Leads with Calculators</a>'+
				'</div>'+
			'</div>'+
			'<div class="footer-img2 col-xs-6 col-sm-3">'+
				'<div class="col-xs-12 np"><img src="images/footer7.jpg" /></div>'+
				'<div class="col-xs-12 np footer-img-text">'+
					'<a href="http://resources.outgrow.co/interactive-calculators-saas-companies">9 Calculators Every SaaS Company Should Consider</a>'+
				'</div>'+
			'</div>'+
			'<div class="footer-img2 col-xs-6 col-sm-3">'+
				'<div class="col-xs-12 np"><img src="images/res7.jpg" /></div>'+
				'<div class="col-xs-12 np footer-img-text">'+
					'<a href="http://resources.outgrow.co/courses/best-interactive-lead-generation-techniques/">Value Added Marketing With Digital Experiences</a>'+
				'</div>'+
			'</div>'+
			'<div class="footer-img2 col-xs-6 col-sm-3">'+
				'<div class="col-xs-12 np"><img src="images/res8.jpg" /></div>'+
				'<div class="col-xs-12 np footer-img-text">'+
					'<a href="http://resources.outgrow.co/courses/lead-generation-with-calculators/">Lead Generation With Interactive Calculators</a>'+
				'</div>'+
			'</div>'+
			'<div class="footer-img2 col-xs-6 col-sm-3">'+
				'<div class="col-xs-12 np"><img src="images/res9.jpg" /></div>'+
				'<div class="col-xs-12 np footer-img-text">'+
					'<a href="http://resources.outgrow.co/how-an-interactive-calculator-generated-11592-qualified-leads/">How an Interactive Calculator Generated 11,592 Qualified Leads</a>'+
				'</div>'+
			'</div>'+
		'</div>'+
	'</div>'+
	'<div class="col-xs-12 np footer-social">'+
			'<ul>'+
				'<li><a href="https://www.facebook.com/OutgrowCo/">Facebook</a></li>'+
				'<li><a href="https://www.linkedin.com/company/outgrow.co">Linkedin</a></li>'+
				'<li><a href="https://twitter.com/outgrowco">Twitter</a></li>'+
				'<li class="border-left"><a href="http://affiliates.outgrow.co/">Affiliate</a></li>'+
				'<li><a href="mailto:p@outgrow.co?Subject=Hello%20again" target="_top">Contact Us</a></li>'+
				'<li><a href="https://angel.co/venturepact/jobs">Careers</a></li>'+
			'</ul>'+
			'<div class="footer-copyright">'+
				'<i class="material-icons">copyright</i>'+
				'<span>Copyrights</span>'+
				'<img src="images/footer-logo-dark.png" />'+
				'<a style="display:none;" href="https://trustlogo.com/install/index5.html?certificatename=Comodo-SSL-Wildcard" target="_blank"><img class="footer-img-2 rs-hide-mb" src="images/comodo_secure.png" /></a>'+
			'</div>'+
		'</div>'+
'</div>';

jQuery(document).ready(function() {
	var str = window.location.href.split('//')[1].split('/')[0];
	var p = str.lastIndexOf('.');
	var ext = str.substring(p+1);
	var href = "//app.outgrow."+ext+"/";
	var trialLink = "//app.outgrow."+ext+"/";
	var loginLink = "//app.outgrow."+ext+"/login";
	var anchorText = "SIGN UP";
	var callText = "SIGN UP";
	if (readCookie('storage')) {
		anchorText = "DASHBOARD";
		callText = "LOGIN";
		href = "//app.outgrow.'+ext+'/dashboard";
		var storage = JSON.parse(readCookie('storage'));
		if(storage.companyList) {
			href = '//'+storage.companyList[1]+'.outgrow.'+ext+'/dashboard';
		}
	}
	var anchorElem = '<a href="'+href+'" class="link-login params" onclick="callGA('+callText+')">'+anchorText+'</a>';
	jQuery('.anchorParent').html(anchorElem);
	jQuery('#trialAnchor').prop('href', trialLink);
	jQuery('#loginAnchor').prop('href', loginLink);
	jQuery('#footer').html(footer);
	var login = '<a href="http://app.outgrow.'+ext+'/login" class="link-login params" onclick="callGA(\'LOGIN\')">Login</a>';
	if (!readCookie('storage'))
		jQuery('.login').html(login);

	setUTMRefCookie();
});

function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function submitEbookData(e) {
	e.preventDefault();
	jQuery('#ebook-error').html('');
	var email = jQuery('#ebook-email').val();
	var name = jQuery('#ebook-name').val();
	if(email == '' || name == '') {
		jQuery('#ebook-error').html('Please fill in the required fields');
		return;
	}
	else {
		jQuery.ajax({
			url: 'ebookhandler.php',
			type: 'POST',
			data: {
				'email' : email,
				'name' : name,
				'group_id': 4043919
			},
			beforeSend: function () {
				jQuery('#ebook-submit').html('Preparing your course ... ');
			},
			success: function (res) {
				var result = JSON.parse(res);
				if(!result.error) {
					jQuery('#ebook-submit').fadeOut();
					if (window.location.href.indexOf('outgrow.co') != -1)
						sendNotification(email, name);
					setTimeout(function (){
						window.location.href="http://resources.outgrow.co/courses/lead-generation-with-calculators/ebook";
					}, 200);
				} else {
					jQuery('#ebook-error').html('There were some errors in the data you provided');
					jQuery('#ebook-submit').html('Get Access<i class="material-icons">arrow_downward</i>');
				}
			},
			error: function (err) {
				jQuery('#ebook-error').html('We are a little backed right now. Please try again.');
				jQuery('#ebook-submit').html('Get Access<i class="material-icons">arrow_downward</i>');
			}
		})
	}
}

function sendNotification (email, name) {
	jQuery.ajax({
		'url': 'js/mailer.php',
		'data': {
			email: email,
			name: name
		},
		'method': 'POST',
		success: function (response) {
			console.log(response);
		},
		error: function (error) {
			console.log(error);
		}
	});
}

function initRefersionCookie () {
    if ('undefined' !== typeof _refersion) {
		setTimeout(function () {
			var rfsn = {};
			rfsn['aid'] = localStorage.getItem('rfsn_aid');
			rfsn['ci'] = localStorage.getItem('rfsn_ci');
			rfsn['cs'] = localStorage.getItem('rfsn_cs');
			rfsn['src'] = localStorage.getItem('rfsn_src');
			for (var key in rfsn) {
				if (null === rfsn[key]) {
					rfsn = null;
					break;
				}
			}
			if (localStorage.getItem('current_rfsn_lsts')) {
				rfsn['current_rfsn_lsts'] = localStorage.getItem('current_rfsn_lsts');
			}
			if (null !== rfsn) {
				createCookie('rfsn', JSON.stringify(rfsn), 365);
			}
		}, 5000);
		return;
    }
    else {
    	setTimeout(function () {
    		initRefersionCookie();
    	}, 5000);
    }
}

function createCookie(name ,value, days, domain) {
    var expires = "";
    var domain  = window.location.host;
    if (days) {
        var date = new Date();
        date.setTime(date.getTime()+(days*24*60*60*1000));
        expires = "; expires="+date.toUTCString();
    }
    document.cookie = name+"="+value+expires+"; domain="+domain+"; path=/";
}

function setUTMRefCookie() {
	let search = window.location.search;

	if ('' !== search && !readCookie('utm_ref')) {
	  search = search.split('?')[1];
	  let utmRefCookie = {
	    'ref': 'UNKNOWN',
	    'utm_source': 'UNKNOWN',
	    'utm_medium': 'UNKNOWN',
	    'utm_campaign': 'UNKNOWN',
	  };
	  let queryParams = search.split('&');
	  queryParams.forEach(param => {
	    let key = param.split('=')[0];
	    let value = param.split('=')[1];
	    if ('ref' === key || 'utm_source' === key || 'utm_medium' === key || 'utm_campaign' === key)
	      utmRefCookie[key] = value;
	  })
	  if ('UNKNOWN' === utmRefCookie.ref) {
	    utmRefCookie.ref = document.referrer ? document.referrer : 'DIRECT';
	  }
	  createCookie('utm_ref', JSON.stringify(utmRefCookie), 365);
	}
}

// function display(hash) {
// 	console.log('Hash received', hash);
// 	jQuery('.hrefTarget > div').empty();
// 	jQuery('.hrefTarget > div').prop('id', hash).attr('data-url', 'https://outgrow1.outgrow.co/'+hash+'?vHeight=1')
// 	initIframe(hash);
// }

function display(url) {
	console.log('Display called', url)
	jQuery('.hrefTarget').empty().append('<iframe src="'+url+'"></iframe>');
}
